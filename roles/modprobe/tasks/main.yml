---
- block:
    - name: Copy keyboard module
      become: true
      copy:
        src: ../files/hid_apple.conf
        dest: /etc/modprobe.d/hid_apple.conf

    - name: Load keyboard module
      become: true
      modprobe:
        name: hid_apple
        state: present

    - name: Regenerate initramfs
      become: true
      shell: mkinitcpio -P
      when: mkinitcpio == "yes"
